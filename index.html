<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smartwatch Task Manager</title>

<style>
/* =========================
   WATCH-OPTIMIZED UI STYLE
   ========================= */
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #000;
  color: #fff;
}

header {
  text-align: center;
  padding: 10px;
  font-weight: bold;
  border-bottom: 1px solid #222;
}

button {
  background: #1e88e5;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 8px;
  width: 100%;
  font-size: 14px;
}

button:active {
  background: #1565c0;
}

.container {
  padding: 10px;
}

.task {
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 10px;
  background: #111;
}

.task.high { border-left: 4px solid #e53935; }
.task.medium { border-left: 4px solid #fbc02d; }
.task.low { border-left: 4px solid #43a047; }

.task.completed {
  opacity: 0.4;
  text-decoration: line-through;
}

input, select {
  width: 100%;
  margin-bottom: 8px;
  padding: 8px;
  border-radius: 6px;
  border: none;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<header>Task Manager</header>

<div class="container" id="taskListView">
  <button onclick="UI.showEditor()">+ New Task</button>
  <div id="taskList"></div>
</div>

<div class="container hidden" id="editorView">
  <input id="title" placeholder="Task title" />
  <input id="desc" placeholder="Description" />
  
  <select id="priority">
    <option value="low">Low</option>
    <option value="medium">Medium</option>
    <option value="high">High</option>
  </select>

  <input type="date" id="dueDate" />

  <button onclick="TaskService.save()">Save Task</button>
  <button onclick="UI.showList()">Cancel</button>
</div>

<script>
/* =========================
   MODEL CONFIGURATION
   ========================= */
const ModelConfig = {
  BASIC: {
    maxTasks: 20,
    reminders: false
  },
  MID: {
    maxTasks: 100,
    reminders: true
  },
  PREMIUM: {
    maxTasks: 500,
    reminders: true
  }
};

// Change model here
const DEVICE_MODEL = ModelConfig.MID;

/* =========================
   EVENT BUS (CORE)
   ========================= */
const EventBus = {
  events: {},
  on(event, handler) {
    (this.events[event] ||= []).push(handler);
  },
  emit(event, data) {
    (this.events[event] || []).forEach(h => h(data));
  }
};

/* =========================
   STORAGE (OFFLINE-FIRST)
   ========================= */
const Storage = {
  key: "watch_tasks",
  load() {
    return JSON.parse(localStorage.getItem(this.key) || "[]");
  },
  save(tasks) {
    localStorage.setItem(this.key, JSON.stringify(tasks));
  }
};

/* =========================
   TASK SERVICE (LOGIC)
   ========================= */
const TaskService = {
  tasks: Storage.load(),

  save() {
    if (this.tasks.length >= DEVICE_MODEL.maxTasks) {
      alert("Task limit reached");
      return;
    }

    const task = {
      id: crypto.randomUUID(),
      title: title.value,
      description: desc.value,
      priority: priority.value,
      dueDate: dueDate.value,
      status: "pending",
      createdAt: Date.now()
    };

    this.tasks.push(task);
    Storage.save(this.tasks);
    EventBus.emit("taskUpdated");
    UI.showList();
  },

  toggle(id) {
    const task = this.tasks.find(t => t.id === id);
    task.status = task.status === "pending" ? "completed" : "pending";
    Storage.save(this.tasks);
    EventBus.emit("taskUpdated");
  },

  remove(id) {
    this.tasks = this.tasks.filter(t => t.id !== id);
    Storage.save(this.tasks);
    EventBus.emit("taskUpdated");
  }
};

/* =========================
   UI CONTROLLER
   ========================= */
const UI = {
  showEditor() {
    taskListView.classList.add("hidden");
    editorView.classList.remove("hidden");
  },

  showList() {
    editorView.classList.add("hidden");
    taskListView.classList.remove("hidden");
    this.render();
  },

  render() {
    const list = document.getElementById("taskList");
    list.innerHTML = "";

    TaskService.tasks.forEach(task => {
      const div = document.createElement("div");
      div.className = `task ${task.priority} ${task.status}`;
      div.innerHTML = `
        <strong>${task.title}</strong><br>
        <small>${task.description}</small><br>
        <button onclick="TaskService.toggle('${task.id}')">✔</button>
        <button onclick="TaskService.remove('${task.id}')">✖</button>
      `;
      list.appendChild(div);
    });
  }
};

/* =========================
   SYSTEM INIT
   ========================= */
EventBus.on("taskUpdated", () => UI.render());
UI.render();
</script>

</body>
</html>
